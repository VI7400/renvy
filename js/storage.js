function getArray(k) { return JSON.parse(localStorage.getItem(k) || '[]') } function setArray(k, a) { localStorage.setItem(k, JSON.stringify(a)) } function nextId(k) { const a = getArray(k); return a.length ? Math.max(...a.map(x => x.id)) + 1 : 1 } function upsert(k, o) { const a = getArray(k); if (!o.id) { o.id = nextId(k); a.push(o) } else { const i = a.findIndex(x => x.id === o.id); if (i >= 0) a[i] = o; else a.push(o) } setArray(k, a); return o } function removeById(k, id) { setArray(k, getArray(k).filter(x => x.id !== id)) } function indexById(arr) { const m = {}; arr.forEach(x => m[x.id] = x); return m }
